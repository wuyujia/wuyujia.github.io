import{_ as i,W as k,X as r,$ as c,a1 as a,Y as n,a2 as d,Z as s,C as l}from"./framework-aa83d01c.js";const m={},v=d('<h2 id="原理解析" tabindex="-1"><a class="header-anchor" href="#原理解析" aria-hidden="true">#</a> 原理解析</h2><h3 id="这个场景是什么呢" tabindex="-1"><a class="header-anchor" href="#这个场景是什么呢" aria-hidden="true">#</a> 这个场景是什么呢？</h3><ol><li>业务要求进行数据导出，只不过数据量特别大；</li><li>数据分析师需要这么多数据进行分析； 无论是哪种，都需要技术帮忙进行数据导出，但是一下子查询这么数据占用内存肯定特别大。如果直接使用ORM框架进行查询，内存怕是会直接炸掉（尤其是在可能存在并发的场景下）</li></ol><p>遇到类似问题，先问一问，业务场景是否合理？一般excel也不能打开这么大数据量的文件，据我所知 office 2007 版也只能够打开104万行数据，03版只能打开65534行数据。</p><h3 id="现有orm在获取大量数据存在的问题" tabindex="-1"><a class="header-anchor" href="#现有orm在获取大量数据存在的问题" aria-hidden="true">#</a> 现有ORM在获取大量数据存在的问题</h3><p>我经常使用的ORM框架是<code>mybatis</code>，优点是：轻量、快速集成、SQL可定制化程度高，尤其是在引入<code>mybatis-plus</code>之后，单表的增删改查也能够通过无SQL模式执行，同时提供有代码生成工具，十分方便。</p><p>MyBtais底层实现是通过JDBC打开连接，执行语句，获取结果，对结果进行映射，直至将所有结果处理之后再返回给调用者使用，数据少没有问题，但是遇到万级以上数据，这就有比较大的问题了，最基本的就是内存占用。</p><p>在高并发的场景下，根本不可能扛住这么大量的数据导出，或者计算。</p><h3 id="解决办法" tabindex="-1"><a class="header-anchor" href="#解决办法" aria-hidden="true">#</a> 解决办法</h3><p>采用<code>流式查询</code>，或者<code>游标查询</code>，如果使用大量数据行的ResultSet，并且无法在JVM中为其分配所需要的内存空间，则可以告诉驱动程序从结果流中返回一行，将这一行数据写出到文件中，写出到流中以后，再访问下一行。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>流式查询有一点需要注意：必须先读取（或关闭）结果集中的所有行，然后才能对连接发出其它查询，否则将引发异常</p><p>也就是说，不要再结果集中使用相同的连接干别的事儿。</p></div><p>使用流式查询，则要保持对结果集的语句所引用的表的并发访问，因为查询会占用连接，所以必须尽快处理。</p><h2 id="环境模拟说明" tabindex="-1"><a class="header-anchor" href="#环境模拟说明" aria-hidden="true">#</a> 环境模拟说明</h2><p>搭建一个新的SpringBoot + Mybatis项目，在数据库中创建500W数据，通过控制JVM内存大小，来模拟<code>普通查询</code>和<code>流式查询</code>下载文件，文件下载格式csv</p><h3 id="数据准备" tabindex="-1"><a class="header-anchor" href="#数据准备" aria-hidden="true">#</a> 数据准备</h3>',15),b=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"docker"),s(` pull mysql:5.7

`),n("span",{class:"token function"},"docker"),s(" run "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token parameter variable"},"--name"),s(" mysql "),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token number"},"3306"),s(":3306 "),n("span",{class:"token parameter variable"},"-e"),s(),n("span",{class:"token assign-left variable"},"MYSQL_ROOT_PASSWORD"),n("span",{class:"token operator"},"="),s(`root mysql:5.7
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),g=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"database"),s(" stream_db "),n("span",{class:"token keyword"},"charset"),s(" utf8"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("t_stream"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),s(`
  `),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"int"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),s(),n("span",{class:"token keyword"},"COMMENT"),s(),n("span",{class:"token string"},"'主键'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("name"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"COMMENT"),s(),n("span",{class:"token string"},"'名称'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("value"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"COMMENT"),s(),n("span",{class:"token string"},"'值'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("create_time"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token keyword"},"CURRENT_TIMESTAMP"),s(),n("span",{class:"token keyword"},"COMMENT"),s(),n("span",{class:"token string"},"'创建时间'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("update_time"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token keyword"},"CURRENT_TIMESTAMP"),s(),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"UPDATE"),s(),n("span",{class:"token keyword"},"CURRENT_TIMESTAMP"),s(),n("span",{class:"token keyword"},"COMMENT"),s(),n("span",{class:"token string"},"'更新时间'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("p",null,"批量插入数据神器😄",-1),y=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[n("span",{class:"token keyword"},"TRUNCATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(" t_stream"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"delimiter"),s(),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"PROCEDURE"),s(" batch_insert"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"IN"),s(" size "),n("span",{class:"token keyword"},"INT"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"BEGIN"),s(`
	`),n("span",{class:"token keyword"},"DECLARE"),s(" i "),n("span",{class:"token keyword"},"INT"),n("span",{class:"token punctuation"},";"),s(`
	`),n("span",{class:"token keyword"},"SET"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
	`),n("span",{class:"token keyword"},"START"),s(),n("span",{class:"token keyword"},"TRANSACTION"),n("span",{class:"token punctuation"},";"),s(`
	`),n("span",{class:"token keyword"},"WHILE"),n("span",{class:"token punctuation"},"("),s("i "),n("span",{class:"token operator"},"<="),s(" size"),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"DO"),s(`
		`),n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(" t_stream "),n("span",{class:"token punctuation"},"("),s("id"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("name"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("value"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"VALUES"),s(),n("span",{class:"token punctuation"},"("),s("i"),n("span",{class:"token punctuation"},","),s(" CONCAT"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'名称: '"),n("span",{class:"token punctuation"},","),s(" i"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" size "),n("span",{class:"token operator"},"+"),s(" i"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
		`),n("span",{class:"token keyword"},"SET"),s(" i"),n("span",{class:"token operator"},"="),s("i"),n("span",{class:"token operator"},"+"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
	`),n("span",{class:"token keyword"},"END"),s(),n("span",{class:"token keyword"},"WHILE"),n("span",{class:"token punctuation"},";"),s(`
	`),n("span",{class:"token keyword"},"COMMIT"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"END"),s(`
`),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"delimiter"),s(),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"CALL"),s(" batch_insert"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5000000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"PROCEDURE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" batch_insert"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("h2",{id:"框架搭建",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#框架搭建","aria-hidden":"true"},"#"),s(" 框架搭建")],-1),h=n("p",null,"全部贴出来太大了，没必要，贴出关键的就行",-1),S=n("div",{class:"language-xml line-numbers-mode","data-ext":"xml"},[n("pre",{class:"language-xml"},[n("code",null,[s(`...
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("parent")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("org.springframework.boot"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("spring-boot-starter-parent"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("2.4.5"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("relativePath")]),n("span",{class:"token punctuation"},"/>")]),s(),n("span",{class:"token comment"},"<!-- lookup parent from repository -->"),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("parent")]),n("span",{class:"token punctuation"},">")]),s(`
...

`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("properties")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("java.version")]),n("span",{class:"token punctuation"},">")]),s("8"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("java.version")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("properties")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependencies")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("org.springframework.boot"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("spring-boot-starter-web"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("mysql"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("mysql-connector-java"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("8.0.28"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("scope")]),n("span",{class:"token punctuation"},">")]),s("runtime"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("scope")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.baomidou"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("mybatis-plus-boot-starter"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("3.5.2"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependencies")]),n("span",{class:"token punctuation"},">")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),T=n("div",{class:"language-properties line-numbers-mode","data-ext":"properties"},[n("pre",{class:"language-properties"},[n("code",null,[n("span",{class:"token key attr-name"},"spring.datasource.url"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"jdbc:mysql://localhost:3306/stream_db?characterEncoding=utf8&useSSL=false"),s(`
`),n("span",{class:"token key attr-name"},"spring.datasource.username"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"root"),s(`
`),n("span",{class:"token key attr-name"},"spring.datasource.password"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"root"),s(`
`),n("span",{class:"token key attr-name"},"spring.datasource.driver-class-name"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"com.mysql.cj.jdbc.Driver"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("example"),n("span",{class:"token punctuation"},"."),s("exportbitdata")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"SneakyThrows")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("beans"),n("span",{class:"token punctuation"},"."),s("factory"),n("span",{class:"token punctuation"},"."),s("annotation"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Autowired")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("http"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"HttpHeaders")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("stereotype"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Controller")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"StopWatch")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("web"),n("span",{class:"token punctuation"},"."),s("bind"),n("span",{class:"token punctuation"},"."),s("annotation"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"RequestMapping")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("web"),n("span",{class:"token punctuation"},"."),s("bind"),n("span",{class:"token punctuation"},"."),s("annotation"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"RequestParam")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("javax"),n("span",{class:"token punctuation"},"."),s("servlet"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ServletOutputStream")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("javax"),n("span",{class:"token punctuation"},"."),s("servlet"),n("span",{class:"token punctuation"},"."),s("http"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"HttpServletResponse")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("io"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"BufferedWriter")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("io"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"IOException")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("io"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"OutputStreamWriter")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"List")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Optional")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token annotation punctuation"},"@Controller"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"StreamController"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token annotation punctuation"},"@Autowired"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"StreamMapper"),s(" streamMapper"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"final"),s(),n("span",{class:"token keyword"},"char"),s(),n("span",{class:"token constant"},"CONJ"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token char"},"','"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/normal"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"normal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token annotation punctuation"},"@RequestParam"),n("span",{class:"token punctuation"},"("),s("required "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token class-name"},"Integer"),s(" size"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"HttpServletResponse"),s(" response"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"IOException"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"StopWatch"),s(" sw "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"StopWatch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Normal Timer"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"setting"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token function"},"downloadSetting"),n("span",{class:"token punctuation"},"("),s("response"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"ServletOutputStream"),s(" out "),n("span",{class:"token operator"},"="),s(" response"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOutputStream"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"BufferedWriter"),s(" writer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"BufferedWriter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"OutputStreamWriter"),n("span",{class:"token punctuation"},"("),s("out"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"GB2312"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1024"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Query Data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"StreamDTO"),n("span",{class:"token punctuation"},">")]),s(" streamDTOS "),n("span",{class:"token operator"},"="),s(" streamMapper"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"normalSelectLimit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Optional"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ofNullable"),n("span",{class:"token punctuation"},"("),s("size"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"orElse"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Write Data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StreamDTO"),s(" streamDTO "),n("span",{class:"token operator"},":"),s(" streamDTOS"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token function"},"writeRow"),n("span",{class:"token punctuation"},"("),s("streamDTO"),n("span",{class:"token punctuation"},","),s(" writer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Flush Data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"flush"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{"),s(`
            writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),s("sw"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"prettyPrint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/stream"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"stream"),n("span",{class:"token punctuation"},"("),n("span",{class:"token annotation punctuation"},"@RequestParam"),n("span",{class:"token punctuation"},"("),s("required "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token class-name"},"Integer"),s(" size"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"HttpServletResponse"),s(" response"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"IOException"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"StopWatch"),s(" sw "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"StopWatch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Stream Timer"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"setting"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token function"},"downloadSetting"),n("span",{class:"token punctuation"},"("),s("response"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"ServletOutputStream"),s(" out "),n("span",{class:"token operator"},"="),s(" response"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOutputStream"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"BufferedWriter"),s(" writer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"BufferedWriter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"OutputStreamWriter"),n("span",{class:"token punctuation"},"("),s("out"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"GB2312"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1024"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Query&Write Data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            streamMapper`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"streamSelectLimit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Optional"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ofNullable"),n("span",{class:"token punctuation"},"("),s("size"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"orElse"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" resultContext "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token class-name"},"StreamDTO"),s(" one "),n("span",{class:"token operator"},"="),s(" resultContext"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getResultObject"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token function"},"writeRow"),n("span",{class:"token punctuation"},"("),s("one"),n("span",{class:"token punctuation"},","),s(" writer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Flush Data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"flush"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            sw`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{"),s(`
            writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),s("sw"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"prettyPrint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"downloadSetting"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"HttpServletResponse"),s(" response"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        response`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setContentType"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"application/csv;charset=gb2312"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        response`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"HttpHeaders"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"CONTENT_DISPOSITION"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"attachment; filename="'),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"currentTimeMillis"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'".csv"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token annotation punctuation"},"@SneakyThrows"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"writeRow"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StreamDTO"),s(" data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BufferedWriter"),s(" writer"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getId"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"CONJ"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getName"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"CONJ"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        writer`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token char"},"'\\n'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),O=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("example"),n("span",{class:"token punctuation"},"."),s("exportbitdata")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("ibatis"),n("span",{class:"token punctuation"},"."),s("annotations"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token operator"},"*")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("ibatis"),n("span",{class:"token punctuation"},"."),s("mapping"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ResultSetType")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("ibatis"),n("span",{class:"token punctuation"},"."),s("session"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ResultHandler")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("stereotype"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Repository")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"List")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token annotation punctuation"},"@Mapper"),s(`
`),n("span",{class:"token annotation punctuation"},"@Repository"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"interface"),s(),n("span",{class:"token class-name"},"StreamMapper"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token annotation punctuation"},"@Select"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SELECT * FROM t_stream LIMIT #{size}"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"StreamDTO"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token function"},"normalSelectLimit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),s(" size"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token annotation punctuation"},"@Options"),n("span",{class:"token punctuation"},"("),s("resultSetType "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ResultSetType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"FORWARD_ONLY"),n("span",{class:"token punctuation"},","),s(" fetchSize "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"Integer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"MIN_VALUE"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token annotation punctuation"},"@ResultType"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StreamDTO"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token annotation punctuation"},"@Select"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SELECT * FROM t_stream LIMIT #{size}"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"streamSelectLimit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token annotation punctuation"},"@Param"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"size"'),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"int"),s(" size"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ResultHandler"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"StreamDTO"),n("span",{class:"token punctuation"},">")]),s(" handler"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token comment"},"# 启动命令"),s(`
`),n("span",{class:"token function"},"java"),s(),n("span",{class:"token parameter variable"},"-Xmx20m"),s(),n("span",{class:"token parameter variable"},"-Xms20m"),s(),n("span",{class:"token parameter variable"},"-jar"),s(` export-bit-data-0.0.1-SNAPSHOT.jar

`),n("span",{class:"token comment"},"# 访问命令"),s(`
`),n("span",{class:"token function"},"curl"),s(" http://localhost:8080/normal?size"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"5000000"),s("  "),n("span",{class:"token comment"},"# 这个直接出现OOM"),s(`
`),n("span",{class:"token function"},"curl"),s(" http://localhost:8080/stream?size"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"5000000"),s("  "),n("span",{class:"token comment"},"# 这个可以直接运行的到结果"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),R=n("p",null,"以上可以得出一个结论，流式查询在解决缓存占用方面有着极大的优势，并且在测试单次查询速度时，优势也是非常大的。",-1),N=n("p",null,"本次工程没有测试多线程环境下的执行效率，以及在高并发环境下，会不会出现别的问题。",-1),I={class:"hint-container warning"},M=n("p",{class:"hint-container-title"},"注意",-1),x=n("p",null,"流式查询比较依赖CPU",-1),L=n("p",null,"对比一下普通查询流程和流式查询流程：",-1),C=n("h2",{id:"技术实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#技术实现","aria-hidden":"true"},"#"),s(" 技术实现")],-1);function A(D,j){const p=l("Tabs"),u=l("Mermaid");return k(),r("div",null,[v,c(p,{id:"59",data:[{title:"Docker启动MySQL"},{title:"MySQL创建DB和表"},{title:"存储过程"}],active:0},{tab0:a(({title:t,value:e,isActive:o})=>[b]),tab1:a(({title:t,value:e,isActive:o})=>[g]),tab2:a(({title:t,value:e,isActive:o})=>[w,y]),_:1}),f,c(p,{id:"76",data:[{title:"pom.xml"},{title:"application.properties"},{title:"StreamController.java"},{title:"StreamMapper.java"},{title:"测试启动脚本"}],active:0},{tab0:a(({title:t,value:e,isActive:o})=>[h,S]),tab1:a(({title:t,value:e,isActive:o})=>[T]),tab2:a(({title:t,value:e,isActive:o})=>[_]),tab3:a(({title:t,value:e,isActive:o})=>[O]),tab4:a(({title:t,value:e,isActive:o})=>[E]),_:1},8,["data"]),R,N,n("div",I,[M,x,L,c(u,{id:"mermaid-109",code:"eJzT1dXlKsksyUm1Ung2c93LhlnP5i99sX7R00k9z7Y2Pt3TD+FygZSl5eSXJ2ckFpUo+ARxKQBBcWlSelFiQQaKTrCMi5OhxrOpG571rnu6a7Kmgq6unUJxalFZapGhxov1u5/2T4NIPpux/uWM3U8Xzns+q0VH4fnsLU87NjzfO/H57jlP9ix4sW/y03U9zzom6DgHhD7tX/9k99KnOzc97VgNVPxkV/fTlv2aYLtS81LQXIPscIhrjLC7xgjFNU929EJco/NkR8OzNQshciD23IU6T/etet63/umSlucT2nSe9i4AuglhPRcA+xCrjg=="})]),C])}const P=i(m,[["render",A],["__file","low_memery_download.html.vue"]]);export{P as default};
