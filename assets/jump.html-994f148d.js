import{_ as n,W as s,X as a,a2 as t}from"./framework-aa83d01c.js";const p={},e=t(`<h2 id="简易跳班机" tabindex="-1"><a class="header-anchor" href="#简易跳班机" aria-hidden="true">#</a> 简易跳班机</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#! /bin/python3</span>

<span class="token keyword">import</span> pexpect
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time

lines <span class="token operator">=</span> <span class="token number">2</span>
columns <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">def</span> <span class="token function">run_cmd</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> patterns<span class="token punctuation">)</span><span class="token punctuation">:</span>
        child <span class="token operator">=</span> pexpect<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
        index <span class="token operator">=</span> child<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>patterns<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> child<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">ssh_client</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> user<span class="token punctuation">,</span> port<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ssh_newkey <span class="token operator">=</span> <span class="token string">&#39;yes/no&#39;</span>
        ssh_passwd <span class="token operator">=</span> <span class="token string">&#39;assword:&#39;</span>
        ssh_confirm <span class="token operator">=</span> <span class="token string">&#39;yes&#39;</span>
        ssh_refuse <span class="token operator">=</span> <span class="token string">&#39;Connection refused&#39;</span>
        ssh_login <span class="token operator">=</span> <span class="token string">&#39;Last login:&#39;</span>
        ssh_repeat_passwd <span class="token operator">=</span> <span class="token string">&#39;Permission denied, please try again&#39;</span>
        ssh_noroutetohost <span class="token operator">=</span> <span class="token string">&#39;No route to host&#39;</span>
        ssh_conntimeout <span class="token operator">=</span> <span class="token string">&#39;Connection timed out&#39;</span>
        <span class="token comment"># 运行ssh完整的命令</span>
        ssh_cmd <span class="token operator">=</span> <span class="token string">&quot;ssh {u}@{h} -p {p}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>u<span class="token operator">=</span>user<span class="token punctuation">,</span> h<span class="token operator">=</span>host<span class="token punctuation">,</span> p<span class="token operator">=</span>port<span class="token punctuation">)</span>
        <span class="token comment"># 初始化一个句柄，并获取索引号</span>
        index<span class="token punctuation">,</span> child <span class="token operator">=</span> run_cmd<span class="token punctuation">(</span>ssh_cmd<span class="token punctuation">,</span> <span class="token punctuation">[</span>
                ssh_newkey<span class="token punctuation">,</span>
                ssh_passwd<span class="token punctuation">,</span>
                ssh_refuse<span class="token punctuation">,</span>
                ssh_login<span class="token punctuation">,</span>
                ssh_noroutetohost<span class="token punctuation">,</span>
                ssh_conntimeout<span class="token punctuation">,</span>
                pexpect<span class="token punctuation">.</span>EOF<span class="token punctuation">,</span>
                pexpect<span class="token punctuation">.</span>TIMEOUT
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                        child<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>ssh_confirm<span class="token punctuation">)</span>
                        <span class="token comment"># 一般第一次ssh时，会让输入yes/no之类的，所以匹配到这个的时候，就做一次递归</span>
                        <span class="token keyword">return</span> ssh_client<span class="token punctuation">(</span>host<span class="token punctuation">,</span> user<span class="token punctuation">,</span> port<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Begin Load Password...&quot;</span><span class="token punctuation">)</span>
                        child<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>passwd<span class="token punctuation">)</span>
                        result <span class="token operator">=</span> child<span class="token punctuation">.</span>expect<span class="token punctuation">(</span><span class="token punctuation">[</span>
                                ssh_repeat_passwd<span class="token punctuation">,</span>
                                ssh_login<span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{} login success (-_-)&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                child<span class="token punctuation">.</span>interact<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token keyword">return</span>
                        <span class="token keyword">elif</span> result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                <span class="token comment"># 说明密码错误，需要重新输入密码，并进行递归</span>
                                passwd <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&#39;Passwd: &#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token keyword">return</span> sshclient<span class="token punctuation">(</span>host<span class="token punctuation">,</span> user<span class="token punctuation">,</span> port<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Connect refused, Pls check ssh port.&quot;</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Login success&quot;</span><span class="token punctuation">)</span>
                        child<span class="token punctuation">.</span>interact<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;The host %s connected faild: No route to host&quot;</span> <span class="token operator">%</span> host<span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;The host %s connected faild: Connection timeout&quot;</span> <span class="token operator">%</span> host<span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Abnormal exit&quot;</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">elif</span> index <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Timeout for connect host %s, pls check network&quot;</span> <span class="token operator">%</span> host<span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token keyword">return</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> e

<span class="token keyword">def</span> <span class="token function">read_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        hosts <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;passwd&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;remark&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;passwd&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;remark&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;passwd&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;remark&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;port&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;passwd&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;remark&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
        <span class="token keyword">return</span> hosts

<span class="token keyword">def</span> <span class="token function">print_help</span><span class="token punctuation">(</span>hosts<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
################################################################################
        &quot;&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
                        \\033[7m星河简易跳版机\\033[0m
        &quot;&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>hosts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\033[1m{n}): {host} \\t({user}) \\t说明: {remark};\\033[0m&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token operator">=</span>idx<span class="token punctuation">,</span> host<span class="token operator">=</span>hosts<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;host&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token operator">=</span>hosts<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> remark<span class="token operator">=</span>hosts<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;remark&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;\\033[7m请选择序号进行登录, 输入 exit 或 Ctrl+c 退出:\\033[0m &quot;</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
        <span class="token comment">#ssh_client(&#39;172.16.116.43&#39;, &#39;root&#39;, &#39;39876&#39;, &#39;Sd@Im&amp;e17LH&#39;)</span>
         configs <span class="token operator">=</span> read_config<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span> 
                        choice <span class="token operator">=</span> print_help<span class="token punctuation">(</span>configs<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> choice <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
                                <span class="token keyword">continue</span>
                        <span class="token keyword">if</span> choice <span class="token operator">==</span> <span class="token string">&#39;exit&#39;</span><span class="token punctuation">:</span>
                                <span class="token keyword">break</span>
                        <span class="token keyword">try</span><span class="token punctuation">:</span>
                                choice <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>choice<span class="token punctuation">)</span>
                                <span class="token keyword">if</span> choice <span class="token operator">&gt;=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span> <span class="token keyword">or</span> choice <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\033[31m入错误，请重新输入\\033[0m&quot;</span><span class="token punctuation">)</span>
                                        <span class="token keyword">continue</span>
                        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\033[31m输入错误，请重新输入\\033[0m&quot;</span><span class="token punctuation">)</span>
                        ssh_client<span class="token punctuation">(</span>configs<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;host&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> configs<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> configs<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;port&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> configs<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;passwd&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> KeyboardInterrupt <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                        <span class="token keyword">continue</span>





</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),o=[e];function c(i,l){return s(),a("div",null,o)}const k=n(p,[["render",c],["__file","jump.html.vue"]]);export{k as default};
