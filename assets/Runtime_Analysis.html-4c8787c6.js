import{_ as p,W as i,X as u,$ as c,a1 as n,a2 as r,C as d,Y as a,Z as s}from"./framework-aa83d01c.js";const k={},b=r('<h2 id="_1-cpu异常分析" tabindex="-1"><a class="header-anchor" href="#_1-cpu异常分析" aria-hidden="true">#</a> 1. CPU异常分析</h2><p>一般来讲我们应该会排查CPU方面的问题。</p><ul><li><strong>1. 业务逻辑问题（死循环）</strong> ⬅️ 这是最常见的问题</li><li><ol start="2"><li>频繁GC</li></ol></li><li><ol start="3"><li>上下文切换过多</li></ol></li></ul><p>等等</p><h3 id="分析步骤" tabindex="-1"><a class="header-anchor" href="#分析步骤" aria-hidden="true">#</a> 分析步骤</h3>',5),m=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"ps"),s(),a("span",{class:"token parameter variable"},"-ef"),s(),a("span",{class:"token operator"},"|"),s(),a("span",{class:"token function"},"grep"),s(` 关键字
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),h=a("p",null,[s("如果找到好多个pid无法确定是哪一个时，可以通过"),a("code",null,"top"),s("命令看一下时哪个进程占用比较高"),a("br"),s(" 主要目的是找出 "),a("code",null,"pid"),s(" 用于调用其它命令")],-1),v=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"top"),s(),a("span",{class:"token parameter variable"},"-Hp"),s(),a("span",{class:"token operator"},"<"),s("pid"),a("span",{class:"token operator"},">"),s(` 
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),g=a("p",null,[s("找到消耗异常的线程ID（实际对应为PID），将其转化为16进制的 "),a("code",null,"nid")],-1),_=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token builtin class-name"},"printf"),s(),a("span",{class:"token string"},"'%x\\n'"),s(),a("span",{class:"token operator"},"<"),s("pid"),a("span",{class:"token operator"},">"),s(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),I=a("p",null,"例如：",-1),T=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[s("$ "),a("span",{class:"token builtin class-name"},"printf"),s(),a("span",{class:"token string"},"'%x\\n'"),s(),a("span",{class:"token number"},"16152"),s(`
3f18
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),j=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[s("jstack "),a("span",{class:"token operator"},"<"),s("进程ID"),a("span",{class:"token operator"},">"),s(),a("span",{class:"token operator"},"|"),a("span",{class:"token function"},"grep"),s(),a("span",{class:"token operator"},"<"),s("线程ID"),a("span",{class:"token operator"},">"),s(),a("span",{class:"token parameter variable"},"-C5"),s(` –color
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),f=a("p",null,"例如：",-1),x=a("div",{class:"language-log line-numbers-mode","data-ext":"log"},[a("pre",{class:"language-log"},[a("code",null,[s(`
`),a("span",{class:"token string"},'"xxl-job, JobThread-97-1684148400029"'),s(),a("span",{class:"token operator"},"#"),a("span",{class:"token number"},"3882"),s(" prio"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"10"),s(" os_prio"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0"),s(" tid"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0x00007f5994058800"),s(" nid"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0x100a"),s(" runnable "),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"0x00007f575eeaf000"),a("span",{class:"token punctuation"},"]"),s(`
   `),a("span",{class:"token property"},"java.lang.Thread.State:"),s(` RUNNABLE
        at java`),a("span",{class:"token punctuation"},"."),s("net"),a("span",{class:"token punctuation"},"."),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("socketRead0"),a("span",{class:"token operator"},"("),s("Native Method"),a("span",{class:"token operator"},")"),s(`
        at java`),a("span",{class:"token punctuation"},"."),s("net"),a("span",{class:"token punctuation"},"."),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("socketRead"),a("span",{class:"token operator"},"("),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"116"),a("span",{class:"token operator"},")"),s(`
        at java`),a("span",{class:"token punctuation"},"."),s("net"),a("span",{class:"token punctuation"},"."),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("read"),a("span",{class:"token operator"},"("),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"171"),a("span",{class:"token operator"},")"),s(`
        at java`),a("span",{class:"token punctuation"},"."),s("net"),a("span",{class:"token punctuation"},"."),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("read"),a("span",{class:"token operator"},"("),s("SocketInputStream"),a("span",{class:"token punctuation"},"."),s("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"141"),a("span",{class:"token operator"},")"),s(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),S=a("p",null,"按照堆栈信息，分析造成线程执行占用资源过高的问题，一步一步分析下去",-1),N=r('<h3 id="jstack-分析不正常线程" tabindex="-1"><a class="header-anchor" href="#jstack-分析不正常线程" aria-hidden="true">#</a> jstack 分析不正常线程</h3><p>通常我们会比较关注 <code>BLOCKED</code>、 <code>WAITING</code> 和 <code>TIMED_WAITING</code> 三种状态的线程，如果这三种比较多，多半是有问题的。</p><div class="hint-container info"><p class="hint-container-title">线程的状态</p><p>初始(NEW)<br> 运行(RUNNABLE)<br> 阻塞(BLOCKED)：表示线程阻塞于锁。<br> 等待(WAITING)：进入该状态的线程需要等待其他线程做出一些特定动作（通知或中断）。<br> 超时等待(TIMED_WAITING)：该状态不同于WAITING，它可以在指定的时间后自行返回。<br> 终止(TERMINATED)</p></div>',3),A=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[s("jstack "),a("span",{class:"token operator"},"<"),s("pid"),a("span",{class:"token operator"},">"),s(),a("span",{class:"token operator"},">"),s(` jstack.log
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),E=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"cat"),s(" jstack.log "),a("span",{class:"token operator"},"|"),s(),a("span",{class:"token function"},"grep"),s(),a("span",{class:"token string"},'"java.lang.Thread.State"'),s(),a("span",{class:"token operator"},"|"),s(),a("span",{class:"token function"},"sort"),s(),a("span",{class:"token parameter variable"},"-nr"),s(),a("span",{class:"token operator"},"|"),s(),a("span",{class:"token function"},"uniq"),s(),a("span",{class:"token parameter variable"},"-c"),s(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),D=a("div",{class:"language-log line-numbers-mode","data-ext":"log"},[a("pre",{class:"language-log"},[a("code",null,[a("span",{class:"token operator"},"#"),s(" cat "),a("span",{class:"token domain constant"},"jstack.log"),s(),a("span",{class:"token operator"},"|"),s(" grep "),a("span",{class:"token string"},'"java.lang.Thread.State"'),s(),a("span",{class:"token operator"},"|"),s(" sort "),a("span",{class:"token operator"},"-"),s("nr "),a("span",{class:"token operator"},"|"),s(" uniq "),a("span",{class:"token operator"},"-"),s(`c
    `),a("span",{class:"token number"},"122"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(" WAITING "),a("span",{class:"token operator"},"("),s("parking"),a("span",{class:"token operator"},")"),s(`
      `),a("span",{class:"token number"},"3"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(" WAITING "),a("span",{class:"token operator"},"("),s("on object monitor"),a("span",{class:"token operator"},")"),s(`
     `),a("span",{class:"token number"},"27"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(" TIMED_WAITING "),a("span",{class:"token operator"},"("),s("sleeping"),a("span",{class:"token operator"},")"),s(`
     `),a("span",{class:"token number"},"12"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(" TIMED_WAITING "),a("span",{class:"token operator"},"("),s("parking"),a("span",{class:"token operator"},")"),s(`
      `),a("span",{class:"token number"},"6"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(" TIMED_WAITING "),a("span",{class:"token operator"},"("),s("on object monitor"),a("span",{class:"token operator"},")"),s(`
     `),a("span",{class:"token number"},"92"),s("    java"),a("span",{class:"token punctuation"},"."),s("lang"),a("span",{class:"token punctuation"},"."),s("Thread"),a("span",{class:"token punctuation"},"."),s("State"),a("span",{class:"token operator"},":"),s(` RUNNABLE
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1);function W(G,C){const l=d("Tabs");return i(),u("div",null,[b,c(l,{id:"37",data:[{title:"1.找到我们关心的进程信息"},{title:"2.找到CPU使用率比较高的一些线程"},{title:"3.找到堆栈信息中该线程的信息"},{title:"4.分析线程调用"}]},{tab0:n(({title:e,value:t,isActive:o})=>[m,h]),tab1:n(({title:e,value:t,isActive:o})=>[v,g,_,I,T]),tab2:n(({title:e,value:t,isActive:o})=>[j,f,x]),tab3:n(({title:e,value:t,isActive:o})=>[S]),_:1},8,["data"]),N,c(l,{id:"79",data:[{title:"生成线程日志"},{title:"线程状态分析"}],active:0},{tab0:n(({title:e,value:t,isActive:o})=>[A]),tab1:n(({title:e,value:t,isActive:o})=>[E,D]),_:1})])}const R=p(k,[["render",W],["__file","Runtime_Analysis.html.vue"]]);export{R as default};
