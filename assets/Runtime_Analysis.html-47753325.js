import{_ as u,W as d,X as k,$ as l,a1 as s,Y as a,Z as n,a2 as i,C as p}from"./framework-aa83d01c.js";const b={},h=i('<h2 id="_1-cpu异常分析" tabindex="-1"><a class="header-anchor" href="#_1-cpu异常分析" aria-hidden="true">#</a> 1. CPU异常分析</h2><p>一般来讲我们应该会排查CPU方面的问题。</p><ul><li><strong>1. 业务逻辑问题（死循环）</strong> ⬅️ 这是最常见的问题</li><li><ol start="2"><li>频繁GC</li></ol></li><li><ol start="3"><li>上下文切换过多</li></ol></li></ul><p>等等</p><h3 id="分析步骤" tabindex="-1"><a class="header-anchor" href="#分析步骤" aria-hidden="true">#</a> 分析步骤</h3>',5),m=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"ps"),n(),a("span",{class:"token parameter variable"},"-ef"),n(),a("span",{class:"token operator"},"|"),n(),a("span",{class:"token function"},"grep"),n(` 关键字
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),v=a("p",null,[n("如果找到好多个pid无法确定是哪一个时，可以通过"),a("code",null,"top"),n("命令看一下时哪个进程占用比较高"),a("br"),n(" 主要目的是找出 "),a("code",null,"pid"),n(" 用于调用其它命令")],-1),g=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"top"),n(),a("span",{class:"token parameter variable"},"-Hp"),n(),a("span",{class:"token operator"},"<"),n("pid"),a("span",{class:"token operator"},">"),n(` 
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),_=a("p",null,[n("找到消耗异常的线程ID（实际对应为PID），将其转化为16进制的 "),a("code",null,"nid")],-1),I=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token builtin class-name"},"printf"),n(),a("span",{class:"token string"},"'%x\\n'"),n(),a("span",{class:"token operator"},"<"),n("pid"),a("span",{class:"token operator"},">"),n(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),f=a("p",null,"例如：",-1),T=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[n("$ "),a("span",{class:"token builtin class-name"},"printf"),n(),a("span",{class:"token string"},"'%x\\n'"),n(),a("span",{class:"token number"},"16152"),n(`
3f18
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),j=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[n("jstack "),a("span",{class:"token operator"},"<"),n("进程ID"),a("span",{class:"token operator"},">"),n(),a("span",{class:"token operator"},"|"),a("span",{class:"token function"},"grep"),n(),a("span",{class:"token operator"},"<"),n("线程ID"),a("span",{class:"token operator"},">"),n(),a("span",{class:"token parameter variable"},"-C5"),n(` –color
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),x=a("p",null,"例如：",-1),A=a("div",{class:"language-log line-numbers-mode","data-ext":"log"},[a("pre",{class:"language-log"},[a("code",null,[n(`
`),a("span",{class:"token string"},'"xxl-job, JobThread-97-1684148400029"'),n(),a("span",{class:"token operator"},"#"),a("span",{class:"token number"},"3882"),n(" prio"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"10"),n(" os_prio"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0"),n(" tid"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0x00007f5994058800"),n(" nid"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0x100a"),n(" runnable "),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"0x00007f575eeaf000"),a("span",{class:"token punctuation"},"]"),n(`
   `),a("span",{class:"token property"},"java.lang.Thread.State:"),n(` RUNNABLE
        at java`),a("span",{class:"token punctuation"},"."),n("net"),a("span",{class:"token punctuation"},"."),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("socketRead0"),a("span",{class:"token operator"},"("),n("Native Method"),a("span",{class:"token operator"},")"),n(`
        at java`),a("span",{class:"token punctuation"},"."),n("net"),a("span",{class:"token punctuation"},"."),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("socketRead"),a("span",{class:"token operator"},"("),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"116"),a("span",{class:"token operator"},")"),n(`
        at java`),a("span",{class:"token punctuation"},"."),n("net"),a("span",{class:"token punctuation"},"."),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("read"),a("span",{class:"token operator"},"("),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"171"),a("span",{class:"token operator"},")"),n(`
        at java`),a("span",{class:"token punctuation"},"."),n("net"),a("span",{class:"token punctuation"},"."),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("read"),a("span",{class:"token operator"},"("),n("SocketInputStream"),a("span",{class:"token punctuation"},"."),n("java"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"141"),a("span",{class:"token operator"},")"),n(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),S=a("p",null,"按照堆栈信息，分析造成线程执行占用资源过高的问题，一步一步分析下去",-1),N=i('<h3 id="jstack-分析不正常线程" tabindex="-1"><a class="header-anchor" href="#jstack-分析不正常线程" aria-hidden="true">#</a> jstack 分析不正常线程</h3><p>通常我们会比较关注 <code>BLOCKED</code>、 <code>WAITING</code> 和 <code>TIMED_WAITING</code> 三种状态的线程，如果这三种比较多，多半是有问题的。</p><div class="hint-container info"><p class="hint-container-title">线程的状态</p><p>初始(NEW)<br> 运行(RUNNABLE)<br> 阻塞(BLOCKED)：表示线程阻塞于锁。<br> 等待(WAITING)：进入该状态的线程需要等待其他线程做出一些特定动作（通知或中断）。<br> 超时等待(TIMED_WAITING)：该状态不同于WAITING，它可以在指定的时间后自行返回。<br> 终止(TERMINATED)</p></div>',3),E=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[n("jstack "),a("span",{class:"token operator"},"<"),n("pid"),a("span",{class:"token operator"},">"),n(),a("span",{class:"token operator"},">"),n(` jstack.log
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),D=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"cat"),n(" jstack.log "),a("span",{class:"token operator"},"|"),n(),a("span",{class:"token function"},"grep"),n(),a("span",{class:"token string"},'"java.lang.Thread.State"'),n(),a("span",{class:"token operator"},"|"),n(),a("span",{class:"token function"},"sort"),n(),a("span",{class:"token parameter variable"},"-nr"),n(),a("span",{class:"token operator"},"|"),n(),a("span",{class:"token function"},"uniq"),n(),a("span",{class:"token parameter variable"},"-c"),n(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),W=a("div",{class:"language-log line-numbers-mode","data-ext":"log"},[a("pre",{class:"language-log"},[a("code",null,[a("span",{class:"token operator"},"#"),n(" cat "),a("span",{class:"token domain constant"},"jstack.log"),n(),a("span",{class:"token operator"},"|"),n(" grep "),a("span",{class:"token string"},'"java.lang.Thread.State"'),n(),a("span",{class:"token operator"},"|"),n(" sort "),a("span",{class:"token operator"},"-"),n("nr "),a("span",{class:"token operator"},"|"),n(" uniq "),a("span",{class:"token operator"},"-"),n(`c
    `),a("span",{class:"token number"},"122"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(" WAITING "),a("span",{class:"token operator"},"("),n("parking"),a("span",{class:"token operator"},")"),n(`
      `),a("span",{class:"token number"},"3"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(" WAITING "),a("span",{class:"token operator"},"("),n("on object monitor"),a("span",{class:"token operator"},")"),n(`
     `),a("span",{class:"token number"},"27"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(" TIMED_WAITING "),a("span",{class:"token operator"},"("),n("sleeping"),a("span",{class:"token operator"},")"),n(`
     `),a("span",{class:"token number"},"12"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(" TIMED_WAITING "),a("span",{class:"token operator"},"("),n("parking"),a("span",{class:"token operator"},")"),n(`
      `),a("span",{class:"token number"},"6"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(" TIMED_WAITING "),a("span",{class:"token operator"},"("),n("on object monitor"),a("span",{class:"token operator"},")"),n(`
     `),a("span",{class:"token number"},"92"),n("    java"),a("span",{class:"token punctuation"},"."),n("lang"),a("span",{class:"token punctuation"},"."),n("Thread"),a("span",{class:"token punctuation"},"."),n("State"),a("span",{class:"token operator"},":"),n(` RUNNABLE
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),G=a("h2",{id:"参考",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#参考","aria-hidden":"true"},"#"),n(" 参考")],-1),C={href:"https://cloud.tencent.com/developer/article/1633434",target:"_blank",rel:"noopener noreferrer"},B={href:"https://zhuanlan.zhihu.com/p/529350757",target:"_blank",rel:"noopener noreferrer"},M={href:"https://www.javatang.com/archives/2017/10/25/36441958.html",target:"_blank",rel:"noopener noreferrer"};function R(L,U){const r=p("Tabs"),c=p("ExternalLinkIcon");return d(),k("div",null,[h,l(r,{id:"37",data:[{title:"1.找到我们关心的进程信息"},{title:"2.找到CPU使用率比较高的一些线程"},{title:"3.找到堆栈信息中该线程的信息"},{title:"4.分析线程调用"}]},{tab0:s(({title:e,value:t,isActive:o})=>[m,v]),tab1:s(({title:e,value:t,isActive:o})=>[g,_,I,f,T]),tab2:s(({title:e,value:t,isActive:o})=>[j,x,A]),tab3:s(({title:e,value:t,isActive:o})=>[S]),_:1},8,["data"]),N,l(r,{id:"79",data:[{title:"生成线程日志"},{title:"线程状态分析"}],active:0},{tab0:s(({title:e,value:t,isActive:o})=>[E]),tab1:s(({title:e,value:t,isActive:o})=>[D,W]),_:1}),G,a("ul",null,[a("li",null,[a("a",C,[n("JAVA 线上故障排查完整套路！牛掰！"),l(c)])]),a("li",null,[a("a",B,[n("线上服务Java进程假死快速排查、分析"),l(c)])]),a("li",null,[a("a",M,[n("JVM故障分析及性能优化系列之四：jstack生成的Thread Dump日志线程状态"),l(c)])])])])}const w=u(b,[["render",R],["__file","Runtime_Analysis.html.vue"]]);export{w as default};
